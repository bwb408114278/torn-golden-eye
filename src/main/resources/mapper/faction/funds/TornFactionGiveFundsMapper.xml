<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pn.torn.goldeneye.repository.mapper.faction.funds.TornFactionGiveFundsMapper">
    <!-- 查询取钱排行榜 -->
    <select id="queryGiveFundsRanking" resultType="pn.torn.goldeneye.repository.model.faction.funds.GiveFundsRankingDO">
        SELECT f.handle_user_id, u.nickname, COUNT(*) AS total, SUM(amount) AS total_amount
        FROM torn_faction_give_funds f
        LEFT JOIN torn_user u ON f.handle_user_id = u.id
        WHERE f.deleted = 0 AND f.faction_id = #{factionId} AND f.user_id != f.handle_user_id
          AND f.withdraw_time BETWEEN #{fromDate} AND #{toDate}
        GROUP BY f.handle_user_id, u.nickname
        ORDER BY total DESC, total_amount DESC
    </select>
</mapper>