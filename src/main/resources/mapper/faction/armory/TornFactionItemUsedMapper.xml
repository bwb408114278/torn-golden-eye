<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pn.torn.goldeneye.repository.mapper.faction.armory.TornFactionItemUsedMapper">
    <!-- 查询物品使用排行榜 -->
    <select id="queryItemUseRanking" resultType="pn.torn.goldeneye.repository.model.faction.armory.ItemUseRankingDO">
        SELECT user_id, user_nickname, COUNT(*) AS total
        FROM torn_faction_item_used
        WHERE deleted = 0 AND faction_id = #{factionId} AND item_name = #{itemName}
          AND use_time BETWEEN #{fromDate} AND #{toDate}
        GROUP BY user_id, user_nickname
        ORDER BY total DESC
        LIMIT 20;
    </select>
</mapper>