<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pn.torn.goldeneye.repository.mapper.faction.armory.TornFactionItemUsedMapper">
    <!-- 查询物品使用排行榜 -->
    <select id="queryItemUseRanking" resultType="pn.torn.goldeneye.repository.model.faction.armory.ItemUseRankingDO">
        SELECT i.user_id, u.nickname, COUNT(*) AS total
        FROM torn_faction_item_used i
        LEFT JOIN torn_user u ON i.user_id = u.id
        WHERE i.deleted = 0 AND i.faction_id = #{factionId} AND i.item_name = #{itemName}
          AND i.use_time BETWEEN #{fromDate} AND #{toDate}
        GROUP BY i.user_id, u.nickname
        ORDER BY total DESC
        LIMIT 20
    </select>
</mapper>